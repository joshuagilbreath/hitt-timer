<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rowing Interval Timer</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; background: #f4f4f4; transition: background 0.3s ease; }
    h1 { font-size: 2rem; }
    #timer { font-size: 5rem; margin: 1rem 0; }
    #label { font-size: 1.5rem; margin-bottom: 1rem; }
    #cycle { font-size: 1.2rem; margin-bottom: 1rem; }
    #stage { font-size: 1rem; margin-bottom: 1rem; color: #666; }
    #upcoming { font-size: 0.9rem; margin-top: 1rem; color: #444; }
    #quote { font-size: 1.1rem; font-style: italic; margin-top: 2rem; color: #2e7d32; }
    button { padding: 1rem 2rem; font-size: 1.2rem; margin: 0.5rem; border-radius: 10px; }
    #progressContainer { width: 100%; background: #ddd; height: 20px; margin-top: 1rem; position: relative; cursor: pointer; }
    #progressBar { width: 0%; height: 100%; background: #4caf50; transition: width 0.2s linear; position: absolute; top: 0; left: 0; }
    #tooltip { position: absolute; background: #333; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; display: none; pointer-events: none; white-space: nowrap; }
  </style>
</head>
<body>
  <h1>Rowing Interval Timer</h1>
  <div id="label">Press Start</div>
  <div id="cycle"></div>
  <div id="stage"></div>
  <div id="timer">5:00</div>
  <button onclick="startWorkout()">Start</button>
  <button onclick="pauseResume()">Pause/Resume</button>
  <button onclick="previousInterval()">Previous</button>
  <button onclick="skipInterval()">Next</button>
  <div id="progressContainer"><div id="progressBar"></div></div>
  <div id="upcoming"></div>
  <div id="quote"></div>
  <div id="tooltip"></div>
  <audio id="beep">
    <source src="https://raw.githubusercontent.com/joshuagilbreath/notification-sounds/main/TEMPLE.mp3" type="audio/mp3">
  </audio>
  <script>
    const timerDisplay = document.getElementById('timer');
    const labelDisplay = document.getElementById('label');
    const cycleDisplay = document.getElementById('cycle');
    const stageDisplay = document.getElementById('stage');
    const upcomingDisplay = document.getElementById('upcoming');
    const quoteDisplay = document.getElementById('quote');
    const beep = document.getElementById('beep');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');
    const tooltip = document.getElementById('tooltip');

    const pyramidSet = [[20, 10], [30, 15], [40, 20], [50, 25], [40, 20], [30, 15], [20, 10]];
    const quotes = [
      "Success usually comes to those who are too busy to be looking for it.",
      "Don't wish for it. Work for it.",
      "The only bad workout is the one that didn’t happen.",
      "Push yourself, because no one else is going to do it for you.",
      "Hard work beats talent when talent doesn’t work hard.",
      "The body achieves what the mind believes."
    ];
    const repeats = 3;
    const fullCycle = [['warmup', 300]];
    for (let i = 0; i < repeats; i++) {
      fullCycle.push(...pyramidSet.flatMap(([s, r]) => [['sprint', s], ['rest', r]]));
    }
    fullCycle.push(['cooldown', 300]);

    let intervalIndex = 0;
    let remaining = 0;
    let timer;
    let paused = false;
    let isDragging = false;

    document.addEventListener('mousedown', () => isDragging = true);
    document.addEventListener('mouseup', () => isDragging = false);

    progressContainer.addEventListener('mousemove', (event) => {
      const rect = progressContainer.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const percent = x / rect.width;
      const index = Math.floor(percent * fullCycle.length);
      if (index >= 0 && index < fullCycle.length) {
        const [label, duration] = fullCycle[index];
        tooltip.style.left = `${x + rect.left}px`;
        tooltip.style.top = `${rect.top - 30}px`;
        tooltip.textContent = `${label.toUpperCase()} (${duration}s)`;
        tooltip.style.display = 'block';
        if (isDragging) {
          intervalIndex = index;
          clearInterval(timer);
          nextInterval();
        }
      } else {
        tooltip.style.display = 'none';
      }
    });

    progressContainer.addEventListener('mouseleave', () => {
      tooltip.style.display = 'none';
    });

    progressContainer.addEventListener('click', (event) => {
      const rect = progressContainer.getBoundingClientRect();
      const clickX = event.clientX - rect.left;
      const percent = clickX / rect.width;
      intervalIndex = Math.floor(percent * fullCycle.length);
      intervalIndex = Math.max(0, Math.min(intervalIndex, fullCycle.length - 1));
      clearInterval(timer);
      nextInterval();
    });

    function startWorkout() {
      intervalIndex = 0;
      quoteDisplay.textContent = '';
      nextInterval();
    }

    function nextInterval() {
      if (intervalIndex >= fullCycle.length) {
        labelDisplay.textContent = 'Workout Complete!';
        timerDisplay.textContent = 'Done';
        cycleDisplay.textContent = '';
        stageDisplay.textContent = '';
        upcomingDisplay.textContent = '';
        document.body.style.background = '#d0ffd0';
        showQuote();
        updateProgressBar();
        return;
      }
      const [label, duration] = fullCycle[intervalIndex];
      labelDisplay.textContent = label.toUpperCase();
      if (label === 'sprint' || label === 'rest') speak(label);
      if (label === 'sprint' || label === 'rest') {
        const currentRound = Math.floor((intervalIndex - 1) / (pyramidSet.length * 2)) + 1;
        const stage = ((intervalIndex - 1) % (pyramidSet.length * 2)) / 2 + 1;
        cycleDisplay.textContent = `Round ${currentRound} of ${repeats}`;
        stageDisplay.textContent = `Stage ${Math.ceil(stage)} of ${pyramidSet.length}`;
      } else {
        cycleDisplay.textContent = '';
        stageDisplay.textContent = '';
      }
      quoteDisplay.textContent = '';
      remaining = duration;
      updateTimer();
      updateUpcoming();
      updateProgressBar();
      updateBackground(label);
      playBeep();
      clearInterval(timer);
      timer = setInterval(countDown, 1000);
    }

    function countDown() {
      if (!paused) {
        remaining--;
        if (remaining <= 5) document.body.style.background = '#ffecb3';
        updateTimer();
        if (remaining <= 0) {
          clearInterval(timer);
          intervalIndex++;
          setTimeout(nextInterval, 500);
        }
      }
    }

    function updateTimer() {
      const mins = Math.floor(remaining / 60);
      const secs = remaining % 60;
      timerDisplay.textContent = `${String(mins).padStart(1, '0')}:${String(secs).padStart(2, '0')}`;
    }

    function playBeep() {
      beep.currentTime = 0;
      beep.play();
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      window.speechSynthesis.speak(utterance);
    }

    function updateProgressBar() {
      const progress = (intervalIndex / fullCycle.length) * 100;
      progressBar.style.width = `${progress}%`;
    }

    function pauseResume() {
      paused = !paused;
    }

    function skipInterval() {
      clearInterval(timer);
      intervalIndex = Math.min(intervalIndex + 1, fullCycle.length - 1);
      nextInterval();
    }

    function previousInterval() {
      clearInterval(timer);
      intervalIndex = Math.max(intervalIndex - 1, 0);
      nextInterval();
    }

    function updateUpcoming() {
      const nextItems = fullCycle.slice(intervalIndex + 1, intervalIndex + 4)
        .map(([label, duration]) => `${label.toUpperCase()} (${duration}s)`).join(' → ');
      upcomingDisplay.textContent = nextItems ? `Next: ${nextItems}` : '';
    }

    function updateBackground(label) {
      const isLastCooldown = (label === 'cooldown' && intervalIndex === fullCycle.length - 1);
      if (isLastCooldown) {
        document.body.style.background = '#d0ffd0';
      } else {
        switch (label) {
          case 'warmup':
          case 'cooldown':
            document.body.style.background = '#e0f7fa';
            break;
          case 'sprint':
            document.body.style.background = '#ce1432';
            break;
          case 'rest':
            document.body.style.background = '#2956f5';
            break;
          default:
            document.body.style.background = '#f4f4f4';
        }
      }
    }

    function showQuote() {
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      quoteDisplay.textContent = `“${quote}”`;
    }
  </script>
</body>
</html>
